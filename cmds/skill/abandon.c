// abandon.c
#include <ansi.h>
#include <input_to.h>
inherit F_CLEAN_UP;
void abandon_skill(string confirm, object me, string skill);
int zero_skill(object me, string arg);
mapping valid_types = ([
//		"array":        "é˜µæ³•",
		"animal-training":  "è®­å…½æœ¯",
		"axe":    	"æ–§æ³•",
		"blade":        "åˆ€æ³•",
		"dagger":       "çŸ­å…µåˆƒ",
		"dodge":        "é—ªèº²æœ¯",
		"force":        "å†…åŠŸ",
		"fork":         "å‰æ³•",
		"hammer":       "é”¤æ³•",
		"iron-cloth": 	"ç¡¬åŠŸ",
		"literate": 	"è¯»å†™",
		"magic":        "æ³•æœ¯",
		"move":         "è½»åŠŸ",
		"parry":        "æ‹›æ¶",
		"perception":   "å¬é£æœ¯",
		"scratching":   "ç¬¦ä¹‹æœ¯",
		"cursism" :	"é™å¤´æœ¯",
		"spells":       "å’’æ–‡",
		"staff":        "æ–æ³•",
		"stealing":     "å¦™æ‰‹æœ¯",
		"sword":        "å‰‘æ³•",
		"throwing":     "æš—å™¨",
		"unarmed":      "æ‹³è„š",
		"whip":     	"é­æ³•",
		"herb":		"è¯é“",
		"spear":        "æªæ³•",
		"musket":				"ç«æª",
]);



int main(object me, string arg)
{
	string err;
	
	if( !arg || arg=="" ) return notify_fail("ä½ è¦æ”¾å¼ƒå“ªä¸€é¡¹æŠ€èƒ½ï¼Ÿ\n");

	if(!find_object(SKILL_D(arg)) && file_size(SKILL_D(arg)+".c")<0) {
		return notify_fail("ã€Œ" + arg + "ã€ï¼Œæœ‰è¿™ç§æŠ€èƒ½å—ï¼Ÿ\n");	
	}
	/*if(!load_object(SKILL_D(arg)+".c")) 
		return notify_fail("ã€Œ" + arg + "ã€ï¼Œæœ‰è¿™ç§æŠ€èƒ½å—ï¼Ÿ\n");
	*/	
    seteuid(getuid());
    err = catch( call_other(SKILL_D(arg)+".c", "???") );
    if (err)
       printf( "å‘ç”Ÿé”™è¯¯ï¼š\n%s\n", err );
	
	if( !me->query_skill(arg,1) && !zero_skill(me,arg))
		return notify_fail("ä½ å¹¶æ²¡æœ‰å­¦è¿‡è¿™é¡¹æŠ€èƒ½ã€‚\n");
		
	if (arg == "magic" || arg == "force" || arg == "spells")
		return notify_fail("è¿™é¡¹åŸºæœ¬æŠ€èƒ½å½±å“ä½ çš„ç²¾æ°”ç¥æ•°å€¼ï¼Œæ— æ³•æ”¾å¼ƒã€‚\n");
		
	write(HIY"\nã€Œæ”¾å¼ƒã€æ˜¯æŒ‡å°†è¿™é¡¹æŠ€èƒ½ä»ä½ äººç‰©çš„èµ„æ–™ä¸­åˆ é™¤ï¼Œå¦‚æœä½ ä»¥åè¿˜è¦ç»ƒï¼Œå¿…é¡»ä»é›¶å¼€\n"
"å§‹é‡ç»ƒï¼Œè¯·åŠ¡å¿…è€ƒè™‘æ¸…æ¥šã€‚\n\n"NOR);
	
	if (me->query("annie/skill_cost/"+arg)>0) {
		write(HIY"ä½ å·²ç»åœ¨è¿™é—¨æŠ€èƒ½ä¸ŠèŠ±è´¹äº†"+me->query("annie/skill_cost/"+arg)+"ç‚¹æ½œèƒ½ï¼Œå»ºè®®ä½ ä½¿ç”¨ï½’ï½…ï½†ï½•ï½ï½„çš„æ–¹å¼æ”¶å›è¿™äº›æ½œ\n"
"èƒ½å­¦å…¶ä»–ä¸œè¥¿ï¼Œï½’ï½…ï½†ï½•ï½ï½„çš„æ–¹å¼è¯·å‚çœ‹ï½ˆï½…ï½Œï½ã€€ï½ï½…ï½—ï½‚ï½‰ï½…çš„ç¬¬ï¼‘ï¼”æ¡ï¼Œæœ¬\n"
"æ¬¡æŒ‡ä»¤ä¸­æ–­ã€‚\n\n"NOR);
		return 1;
	}
	
	write("ä½ ç¡®å®šæ”¾å¼ƒç»§ç»­å­¦ä¹ ï¼»"HIR + SKILL_D(arg)->name() + NOR"ï¼½ï¼Œæ˜¯å¦è¦ç»§ç»­ï¼Ÿ(yes/no)\n");
	input_to("abandon_skill",INPUT_PROMPT,"", me, arg);
	return 1;
}

void abandon_skill(string confirm, object me, string skill) 
{
	if (! (confirm == "yes" || confirm == "YES")) 
		write("ä½ å‡ºäº†ä¸€èº«å†·æ±—ï¼Œå¥½é™©ï¼\n");
	else    {
        	if(me->query_skill(skill,1)>50)
        	log_file("skills/ABANDON",
        	  sprintf("%s(%s)åœ¨%sæ”¾å¼ƒäº†%dçº§%sã€‚\n",
        	  me->name(1),geteuid(me),ctime(time()),me->query_skill(skill,1),skill));
		me->delete_skill(skill);
		me->reset_action();
		write("ä½ å†³å®šæ”¾å¼ƒç»§ç»­å­¦ä¹ " + SKILL_D(skill)->name() + "ã€‚\n");
	}
}


int zero_skill(object me, string arg) {
	mapping learned_skill_points;
	
	learned_skill_points=me->query_learned();
	if (!mappingp(learned_skill_points))	return 0;
	if (!learned_skill_points[arg]) return 0;
	return 1;
}


	
	
	

int help()
{
	write("[0;1;37mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m\n"
"[0;1;36mæŒ‡ä»¤æ ¼å¼ï¼šabandon <æŠ€èƒ½åç§°>[0m\n"
"[0;1;37mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m\n"
"\n"
"æ”¾å¼ƒä¸€é¡¹ä½ æ‰€å­¦çš„æŠ€èƒ½ï¼Œæ³¨æ„è¿™é‡Œæ‰€è¯´çš„ã€Œæ”¾å¼ƒã€æ˜¯æŒ‡å°†è¿™é¡¹æŠ€èƒ½ä»ä½ äºº\n"
"ç‰©çš„èµ„æ–™ä¸­åˆ é™¤ï¼Œå¦‚æœä½ ä»¥åè¿˜è¦ç»ƒï¼Œå¿…é¡»ä»0å¼€å§‹é‡ç»ƒï¼Œè¯·åŠ¡å¿…è€ƒè™‘æ¸…\n"
"æ¥šã€‚\n"
"\n"
"è¿™ä¸ªæŒ‡ä»¤ä½¿ç”¨çš„åœºåˆé€šå¸¸æ˜¯ç”¨æ¥åˆ é™¤ä¸€äº›ã€Œä¸å°å¿ƒã€ç»ƒå‡ºæ¥çš„æŠ€èƒ½ï¼Œç”±æ–¼\n"
"æˆ‘ä»¬å‡è®¾ä½ çš„äººç‰©éšæ—¶éƒ½ä¼šä»ä»–ï¼å¥¹çš„å„ç§åŠ¨ä½œã€æˆ˜æ–—ä¸­å­¦ä¹ ï¼Œå› æ­¤æœ‰äº›\n"
"æŠ€èƒ½ä¼šå› ä¸ºä½ ç»å¸¸åœ°ä½¿ç”¨è€Œå‡ºç°åœ¨ä½ çš„æŠ€èƒ½åˆ—è¡¨ä¸­ï¼Œè¿™ä¸ªäººç‰©å°±å¿…é¡»èŠ±è´¹\n"
"ä¸€äº›ç²¾ç¥å»ã€Œè®°ä½ã€æ‰€å­¦è¿‡çš„ä¸€åˆ‡ï¼Œç„¶è€Œï¼Œäººçš„èµ„è´¨å„æœ‰ä¸åŒï¼Œçµæ€§é«˜çš„\n"
"äººèƒ½å¤Ÿå­¦ä¹ è®¸å¤šæŠ€èƒ½è€Œæˆä¸ºå¤šæ‰å¤šè‰ºçš„æ‰å­ï¼Œçµæ€§è¾ƒå·®çš„äººå°±åªèƒ½ä¸“å¿ƒæ–¼\n"
"ç‰¹å®šå‡ é¡¹æŠ€èƒ½ï¼Œå¦‚æœä½ å­¦çš„æŠ€èƒ½ç§ç±»å¤ªå¤šï¼Œè¶…è¿‡ä½ çš„çµæ€§ï¼Œä½ ä¼šå‘ç°äººç‰©\n"
"çš„å­¦ä¹ é€Ÿåº¦å°†æ¯”åªå­¦å‡ ç§æŠ€èƒ½çš„äººæ…¢ï¼Œè¶…è¿‡è¶Šå¤šï¼Œå­¦ä¹ æ•ˆæœä½è½çš„æƒ…å†µè¶Š\n"
"ä¸¥é‡ï¼Œè¿™ç§æƒ…å½¢å°±åƒæ˜¯ä¸€ä¸ªå­¦æœŸåŒæ—¶é€‰ä¿®å¤ªå¤šå­¦åˆ†ï¼Œè™½ç„¶ä½ ä»ç„¶å¯ä»¥å‡­è‘—\n"
"è¶…äººçš„æ„å¿—åŠ›ç»ƒä¸‹å»ï¼Œä¸è¿‡è¿™å°†ä¼šå¤šèŠ±è´¹ä½ è®¸å¤šå®è´µçš„æ—¶é—´ã€‚\n"
"\n"
"æ³¨ï¼šå­¦ä¹ æŠ€èƒ½æ€»æ•°ï¼çµæ€§ï¼‹ï¼‘æ—¶å­¦ä¹ æ•ˆç‡å°†é™ä½ã€‚\n"
"[0;1;37mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m\n"
""
	);
	return 1;
}
