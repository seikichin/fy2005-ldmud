// meditate.c

#include <skill.h>

inherit F_CLEAN_UP;

int main(object me, string arg)
{
    	int sen_cost=30, mana_gain;
    
    	seteuid(getuid());
	
	if (userp(me))
    		return notify_fail("æ­¤æŒ‡ä»¤å·²è¢«exerciseå–ä»£ï¼Œè¯·help exercise \n");
	
    	if(environment(me)->query("no_fight"))
        	return notify_fail("ä½ ä¸å¯ä»¥åœ¨è¿™é‡Œå†¥æ€ã€‚\n");
    	if( me->is_fighting() ) return notify_fail("æˆ˜æ–—ä¸­å†¥æ€â€”â€”æ‰¾æ­»å—ï¼Ÿ\n");
    	if( me->is_busy() )
        	return notify_fail("ä½ ä¸Šä¸€ä¸ªåŠ¨ä½œè¿˜æ²¡æœ‰å®Œæˆï¼Œä¸èƒ½å†¥æ€ã€‚\n");
    
    	if( arg && !sscanf(arg, "%d", sen_cost) )
        	return notify_fail("ä½ è¦èŠ±å¤šå°‘ç²¾ç¥å†¥æ€ï¼Ÿ\n");
    
    	if( sen_cost < 10 ) return notify_fail("ä½ æœ€å°‘è¦èŠ± 10 ç‚¹ã€Œç¥ã€æ‰èƒ½å†¥æ€ã€‚\n");
    
    	if( ({int})me->query("sen") < sen_cost )
        	return notify_fail("ä½ ç°åœ¨ç²¾ç¥å¤ªå·®äº†ï¼Œè¿›è¡Œå†¥æ€å°†ä¼šè¿·å¤±ï¼Œæ°¸è¿œé†’ä¸è¿‡æ¥ï¼\n");
    
    	if( ({int})me->query("kee") * 100 / ({int})me->query("max_kee") < 70 )
        	return notify_fail("ä½ ç°åœ¨èº«ä½“çŠ¶å†µå¤ªå·®äº†ï¼Œæ— æ³•é›†ä¸­ç²¾ç¥ï¼ï¼ˆæ°”è¡€å€¼è‡³å°‘åœ¨70%ä»¥ä¸Šï¼‰\n");
    
    	if( ({int})me->query("gin") * 100 / ({int})me->query("max_gin") < 70 )
        	return notify_fail("ä½ ç°åœ¨èº«ä½“çŠ¶å†µå¤ªè™šå¼±äº†ï¼Œæ— æ³•è¿›å…¥å†¥æ€çš„çŠ¶æ€ï¼ï¼ˆç²¾åŠ›å€¼è‡³å°‘åœ¨70%ä»¥ä¸Šï¼‰\n");
    
    	write("ä½ ç›˜è†è€Œåï¼Œé™åå†¥æ€äº†ä¸€ä¼šå„¿ã€‚\n");
    
    	me->add("sen", -sen_cost);
    	me->start_busy(1);
    // This function ranged from 1 to 15 when sen_cost = 30
    	mana_gain = sen_cost * (({int})me->query_skill("spells")/10 
                            + ({int})me->query_spi() ) / 30;
    	mana_gain = (mana_gain + random(mana_gain))/5;
    
    	if( mana_gain < 1 ) {
        	write("ä½†æ˜¯å½“ä½ çå¼€çœ¼ç›ï¼Œåªè§‰å¾—è„‘ä¸­ä¸€ç‰‡ç©ºç™½ã€‚\n");
        	return 1;
    	}
    
    	me->add("mana", mana_gain );
    
    	if( ({int})me->query("mana") > ({int})me->query("max_mana") * 2) {
        	if( ({int})me->query("max_mana") >=  (({int})me->query_skill("spells", 1) +
             			me->query_skill("spells")/5) * 5 ) {
            		write("ä½ å¿½ç„¶è§‰å¾—è„‘ä¸­ä¸€ç‰‡æ··ä¹±ï¼Œä¼¼ä¹æ³•åŠ›çš„æå‡å·²ç»åˆ°äº†ç“¶é¢ˆã€‚\n");
            		me->set("mana", 2*me->query("max_mana"));
        	} else {
            		write("ä½ çš„æ³•åŠ›æé«˜äº†ï¼\n");
			me->add("max_mana", 1);
			me->set("mana", me->query("max_mana"));
        	}
    	}	
    	return 1;
}


int help(object me)
{
    write("[0;1;37mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m\n"
"[0;1;36mæŒ‡ä»¤æ ¼å¼ : meditate [<è€—è´¹ã€Œç¥ã€çš„é‡ï¼Œé¢„è®¾å€¼ 30>][0m\n"
"[0;1;37mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m \n"
"é™åå†¥æ€ï¼Œå°†æ¸¸ç¦»çš„ç²¾ç¥åŠ›æœ‰æ•ˆåœ°é›†ä¸­å‡èšæˆèƒ½å¤Ÿç”¨æ¥æ–½å±•æ³•æœ¯çš„èƒ½é‡\n"
"ï¼Œè—‰ä»¥å¢åŠ è‡ªå·±çš„æ³•åŠ›ã€‚\n"
"\n"
"æ‰“åå¾—åˆ°çš„æ³•åŠ›æœ€å¤§å€¼ == åŸºæœ¬å’’æœ¯ç­‰çº§*5 + å½“å‰çš„æœ‰æ•ˆå’’æœ¯ç­‰çº§\n"
"ä¸¾ä¾‹:ã€€å’’æœ¯ (spells)                           - æ·±ä¸å¯æµ‹ 200\n"
"  ã€€ã€€ å’’æ–‡ (spells)         ï¼š éº»å©†å¯’ç»ƒæœ¯       æœ‰æ•ˆç­‰çº§ï¼š500  \n"
"æ³•åŠ›æœ€å¤§å€¼ = 200*5 + 500 = 1500\n"
"\n"
"å¹³å‡è½¬åŒ–æ•ˆç‡ï¼ ï¼ˆæœ‰æ•ˆå’’æœ¯ç­‰çº§ï¼ï¼‘ï¼ï¼‹çµæ€§ï¼‰ï¼ï¼‘ï¼ï¼\n"
"\n"
"è¯·å‚è€ƒ help attributes.txt \n"
"ç›¸å…³æŒ‡ä»¤ï¼š\n"
"	å¢åŠ å†…åŠ›	ï½…ï½˜ï½…ï½’ï½ƒï½‰ï½“ï½…	\n"
"	å¢åŠ çµåŠ›	ï½’ï½…ï½“ï½ï½‰ï½’ï½ï½”ï½…\n"
"	\n"
"	æ¢å¤ä½“åŠ›ï¼š	ï½…ï½˜ï½…ï½’ï½”ã€€ï½’ï½…ï½ƒï½ï½–ï½…ï½’\n"
"	æ¢å¤å¿ƒç¥ï¼š	ï½…ï½˜ï½…ï½’ï½”ã€€ï½’ï½…ï½†ï½’ï½…ï½“ï½ˆ\n"
"	æ¢å¤ç²¾åŠ›ï¼š	ï½…ï½˜ï½…ï½’ï½”ã€€ï½’ï½…ï½‡ï½…ï½ï½…ï½’ï½ï½”ï½…\n"
"[0;1;37mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m\n"
""
        );
    return 1;
}
